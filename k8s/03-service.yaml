---
# ─── Internal ClusterIP Service ───────────────────────────────────────────────
# Use this to access nginx-rtmp from within the cluster.
apiVersion: v1
kind: Service
metadata:
  name: nginx-rtmp
  namespace: streaming
  labels:
    app: nginx-rtmp
spec:
  selector:
    app: nginx-rtmp
  ports:
    - name: rtmp
      port: 1935
      targetPort: 1935
      protocol: TCP
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
  type: ClusterIP

---
# ─── External LoadBalancer Service ────────────────────────────────────────────
# Exposes RTMP (1935) and HTTP/HLS (8080) to the outside world.
# Works out-of-the-box on cloud providers (AWS, GCP, Azure).
# For local clusters (minikube / kind), use NodePort or port-forward instead.
apiVersion: v1
kind: Service
metadata:
  name: nginx-rtmp-external
  namespace: streaming
  labels:
    app: nginx-rtmp
    type: external
  annotations:
    # Optional: uncomment for AWS NLB (better for TCP/RTMP)
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
spec:
  selector:
    app: nginx-rtmp
  ports:
    - name: rtmp
      port: 1935
      targetPort: 1935
      protocol: TCP
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
  type: LoadBalancer